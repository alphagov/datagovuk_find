<% content_for :page_title do %>
  Results for "<%= @query %>" - Find Data Alpha
<% end %>

<h1 class="heading-large">Search results</h1>

<div class="grid-row">
  <div class="column-two-thirds">
    <form id="dgu-search-box" action="/search" method="GET">
      <label for="q" class="visuallyhidden">Search</label>
      <input id="q" name="q" type="text" class="form-control dgu-search-box__input" value="<%= @query %>"/><button type="submit" class="dgu-search-box__button">Find data</button>
    </form>
  </div>
</div>

<div class="grid-row results">
  <div class="column-one-third">
    <%= render 'filters' %>
  </div>

  <div class="column-two-thirds filters">
    <div>
      <span class="bold-small"><%= @num_results %></span>
      results found <% unless @query.empty? %>for
      <span class="bold-small">'<%= @query %>'<% end %></span>
      <% if @sorted_by %> sorted by
      <span class="bold-small">'<%= @sorted_by %>'<% end %></span>
      <% if @organisation %> published by
      <span class="bold-small">'<%= @organisation %>'<% end %></span>
      <% if @location %> filtered by
      <span class="bold-small">'<%= @location %>'<% end %></span>
    </div>

    <% @datasets.each do |d| %>
      <div class="result">
        <div class="">
          <h2 class="heading-medium">
            <a href="/dataset/<%= d.name %>"><%= d.title %></a>
          </h2>
          <dl class="metadata">
            <dt>Published by:</dt>
            <dd><%= link_to d.organisation['title'], search_path(publisher: d.organisation['title']) %></dd>
            <dt>Last updated:</dt>
            <dd><%= format(d.updated_at) %></dd>
            <dt>Geographical area:</dt>
            <% if d.location1.present? %>
              <dd><%= d.location1 %></dd>
            <% else %>
              <dd class="unavailable">Not applicable</dd>
            <% end %>
          </dl>
          <p><%= truncate(strip_tags(d.summary), length: 200, separator: ' ') %></p>
        </div>
      <% end %>

      <%= paginate @datasets %>
    </div>
  </div>
</div>
